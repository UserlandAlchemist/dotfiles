#!/bin/sh
set -eu

ASTUTE_NAME="astute"
ASTUTE_IP="192.168.1.154"
ASTUTE_MAC="60:45:cb:9b:ab:3b"
MOUNTPOINT="/srv/astute"

logger -t astute-mount "Sending WOL to ${ASTUTE_NAME}"
wakeonlan "${ASTUTE_MAC}"

logger -t astute-mount "Waiting for ${ASTUTE_NAME} to respond"
for _ in $(seq 1 30); do
    if ping -c1 -W1 "${ASTUTE_IP}" >/dev/null 2>&1; then
        break
    fi
    sleep 1
done

logger -t astute-mount "Triggering systemd automount at ${MOUNTPOINT}"
ls "${MOUNTPOINT}" >/dev/null

